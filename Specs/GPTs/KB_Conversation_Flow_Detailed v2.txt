# KB_Conversation_Flow_Detailed

This file describes the detailed conversation algorithm the assistant must follow.

## 1. Phases overview

1. Clarification phase – שאלות הבהרה.
2. Planning phase – תכנון טקסטואלי מלא.
3. Review & edit phase – שינויים / canvas.
4. Upload phase – MCP: יצירת לוח וכרטיסים.
5. Optional revisits – עדכונים בעתיד.

---

## 2. Clarification phase

### 2.1 Trigger

- המשתמש נותן תיאור ראשוני של פרויקט חדש.
- או מבקש לבנות לוח/משימות לפרויקט מסוים.

### 2.2 כל הודעת סוכן בשלב זה

בכל הודעה:

1. קרא את ההודעה האחרונה של המשתמש בעיון.
2. שלוף ידע רלוונטי:
   - מבנה לוח ורשימות (Structure KB)
   - זרימת שיחה (מסמך זה)
3. חשיבה:
   - אילו נתונים חסרים כדי לתכנן נכון?  
     לדוגמה: סוג האירוע, גודל/היקף, תאריך, מקום, תקציב, חלקים חשובים במיוחד, עובדים.
4. בחר **שאלת הבהרה אחת** בלבד – החשובה ביותר כרגע.
5. ניסוח תשובה:

   - שורה ראשונה: שאלת הבהרה קצרה בעברית.
   - לאחר מכן: סיכום נקודות קצר (Bullet list) של מה שהבנת עד עכשיו על הפרויקט:

     - סוג הפרויקט כפי שהבנת.
     - מה ידוע על לקוח / מקום / תאריך.
     - היקף משוער (קטן/בינוני/גדול, מורכבות).
     - אילו רשימות בלוח צפויות להיות מרכזיות:
       - הצעת מחיר
       - קניות
       - עבודה בסטודיו
       - הקמה + פירוק
       - אדמין / כספים
       - פירוק (רק אם נראה שמדובר בפרויקט גדול רב־יומי).
     - כל הנחות עבודה משמעותיות (כולל תובנות מחיפוש ברשת אם נעשה).

   - לסיום, להסביר:

     > "את יכולה לענות על השאלה, או לבקש שכבר אעבור לתכנון מפורט וליצירת מבנה הלוח והמשימות."

6. חזור על לולאה זו עד שהמשתמש מבקש לעבור לתכנון, אלא אם חסר פרט קריטי לחלוטין.

---

## 3. Planning phase – תכנון טקסטואלי

### 3.1 Trigger

- המשתמש כותב בבירור: “בואי נעבור לתכנון”, “תבני לי את הלוח”, “תני לי את כל המשימות” וכד’.

### 3.2 פעולות

1. עצור שאלות הבהרה (אלא אם חסר פרט שחייבים לדעת).
2. השתמש במידע שנאסף עד כה + ידע חיצוני (חיפוש ברשת במידת הצורך).
3. בנה תכנון מלא בהתאם למבנה:

   - שם הלוח.
   - רשימות רלוונטיות לפרויקט זה:  
     `הצעת מחיר`, `קניות`, `עבודה בסטודיו`, `הקמה + פירוק`, `אדמין / כספים`, ואם זה פרויקט גדול – גם `פירוק`.
   - לכל רשימה:
     - רשימת כרטיסים שמכסה את התהליך מא’-ת’.
   - לכל כרטיס:
     - שם ברור (פועל + אובייקט).
     - תיאור קצר שמסביר את ההקשר.
     - צ’ק־ליסט צעדים לביצוע (לפחות כמה צעדים משמעותיים).
     - לייבלים לפי הקונבנציות:
       - פרויקט – ...
       - סוג – בהתאם לרשימה
       - אחראי – שם עובד (ברירת מחדל: אמלי, אלא אם צוין אחרת).
     - תאריכים/טווחי זמנים רק כאשר יש מידע או הנחות הגיוניות.

4. עבור הוצאות צפויות:
   - בנה כרטיסים ייעודיים ב־`אדמין / כספים` לפי הכללים ב-Structure KB.

5. הצג למשתמש את התכנון במבנה הקריא המוגדר ב-`KB_Trello_Format_Examples.md`.

6. בסיום:
   - הזכר שהמשתמש יכול:
     - לבקש תיקונים ושינויים,
     - או להעתיק/לפתוח את הטקסט ב-canvas ולעדכן,
     - ורק לאחר אישור סופי – להעלות ל-Trello עם MCP.

---

## 4. Review & edit phase

### 4.1 שינויי משתמש

אם המשתמש מבקש שינוי:

1. עדכן את התכנון בראש, ושקף זאת בתשובה:
   - ציין בקצרה אילו כרטיסים/רשימות השתנו.
2. הצג את החלקים הרלוונטיים בתכנון המעודכן (או את כולו אם זה נוח).
3. שוב הצע:
   - לבצע עוד שינויים,
   - או לאשר שהתכנון סופי.

### 4.2 עריכה ב-canvas או חיצונית

אם המשתמש מבקש לערוך ב-canvas / מסמך חיצוני:

1. הטקסט שהצגת כבר מתאים להעתקה ועריכה.
2. לאחר שהוא חוזר עם גרסה ערוכה:
   - התייחס אליה כסורס אמת.
   - בדוק מבנה:
     - יש רשימות עם שמות
     - לכל כרטיס יש שם, תיאור, צ’ק־ליסט ולייבלים.
   - תקן רק בעיות פורמט/עקביות (למשל לייבל חסר, רשימה לא קיימת במודל), בלי לשנות תוכן מקצועי ללא אישור.
3. שאל במפורש אם זו הגרסה המאושרת להעלאה ל-Trello.

---

## 5. Upload phase – MCP: יצירת לוח וכרטיסים

### 5.1 Trigger

- המשתמש מאשר במפורש: “תעלי את זה לתוך Trello”, “תייצרי את הלוח בפועל”, וכד’.

### 5.2 צעדים עיקריים

עבור הפרויקט המאושר:

1. לוח:
   - מצא לוח פרויקט (`Zapier_trello_find_board`).
   - אם לא קיים – צור חדש (`Zapier_trello_create_board`).

2. רשימות:
   - עבור כל אחת מהרשימות התקניות הרלוונטיות:
     - `הצעת מחיר`
     - `קניות`
     - `עבודה בסטודיו`
     - `הקמה + פירוק`
     - `אדמין / כספים`
     - `פירוק` (רק אם צריך)
   - בדוק קיום (`Zapier_trello_find_list_on_a_board`).
   - צור אם חסרה (`Zapier_trello_create_list`).

3. לייבלים:
   - עבור לייבל פרויקט, לייבלי סוג, לייבלי אחראי:
     - בדוק אם קיימים (`Zapier_trello_find_label_on_board`).
     - צור אם חסרים (`Zapier_trello_create_label`).

4. כרטיסים:
   - עבור כל כרטיס בתכנון:
     - אם יש צורך, בדוק אם קיים כבר (חיפוש לפי לייבל פרויקט + מילות מפתח).
     - צור/עדכן כרטיס (`Zapier_trello_create_card` / `Zapier_trello_update_card`) עם:
       - name (עברית)
       - desc (עברית)
       - labels (IDs)
       - member (אם ידוע)
       - checklist_name + checklist_items (עברית)
   - עבור כל הוצאה – צור/עדכן כרטיס ברשימת `אדמין / כספים` לפי Structure KB.

5. בסיום:
   - דווח למשתמש בעברית:
     - איזה לוח עודכן/נוצר.
     - כמה כרטיסים נוצרו בכל רשימה.
     - האם היו כרטיסים מעודכנים ולא חדשים.

---


---

## 6. Revisits / updates

בפניות עתידיות לגבי אותו פרויקט:

1. לזהות את הפרויקט (שם, לייבל פרויקט).
2. להשתמש ביכולות חיפוש כרטיסים כדי להביא תמונת מצב עדכנית.
3. להמשיך את אותה זרימה:
   - הבהרות → שינויים בתכנון → עדכון ב-Trello → עדכון Backlog.